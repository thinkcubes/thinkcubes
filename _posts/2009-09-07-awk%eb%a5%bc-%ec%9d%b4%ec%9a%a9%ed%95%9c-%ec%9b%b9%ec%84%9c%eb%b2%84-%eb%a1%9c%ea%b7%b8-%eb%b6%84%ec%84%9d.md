---
ID: 469
post_title: awk를 이용한 웹서버 로그 분석
author: ""
post_date: 2009-09-07 10:09:00
post_excerpt: ""
layout: post
permalink: 'http://52.78.225.187/2009/09/07/awk%eb%a5%bc-%ec%9d%b4%ec%9a%a9%ed%95%9c-%ec%9b%b9%ec%84%9c%eb%b2%84-%eb%a1%9c%ea%b7%b8-%eb%b6%84%ec%84%9d/'
published: true
---
<P style="MARGIN-RIGHT: 0px">0) prologue<BR><BR>&nbsp;&nbsp; &nbsp; <img src="http://52.78.225.187/wp-content/uploads/1/6705690054.png" width="185" height="180" /><BR><BR><BR>1) awk는 ?<BR><BR>&nbsp; : 설계자인 Aho, Weingrger, Kernighan 의 첫 글자로 명명되어진 인터프리터 프로그래밍 언어이다.<BR><BR>&nbsp; &nbsp; 필터링, 치환, 간단한 리포팅 작업을 할 수 있어서 편리하다.<BR><BR>&nbsp; &nbsp; 화면에 출력되는 내용을 열로 나누어 특정열만 뽑아내는 명령이다.(explode와 비슷)<BR><BR>&nbsp; &nbsp; <img src="http://52.78.225.187/wp-content/uploads/1/7998071648.png" width="419" height="269" /><BR><BR><BR>2) awk의 형식 ?<BR><BR>&nbsp; : BEGIN { ... } /Pattern Statement/ {action} END { ... }<BR><BR>&nbsp; &nbsp; 먼저 실행되는 부분인 BEGIN, 우리가 처리하고자 하는 작업 부분, <BR><BR>&nbsp; &nbsp; 그리고 프로그램을 종료할 때 쓰는 END로 이루어져 있다.<BR><BR><BR>&nbsp; &nbsp; awk [옵션] '스크립트' [-v 변수=값] [파일(들)] <BR><BR>&nbsp; &nbsp; awk [옵션] -f 스크립트 파일 [-v 변수=값] [파일(들)] <BR><BR><BR>&nbsp; &nbsp; -Fc : field separator 지정<BR><BR>&nbsp; &nbsp; Fc는 필드 사이를 구분하는 구분자이다 <BR><BR>&nbsp; &nbsp; 직접 지정하지 않으면 공백을 기준으로 한다 <BR><BR>&nbsp; &nbsp; 시스템 변수 FS를 지정하는 것과 같은 효과를 지닌다 <BR><BR><BR>&nbsp; &nbsp; -v 변수 = 값 <BR><BR>&nbsp; &nbsp; 스크립트를 실행하기 전에 미리 변수를 지정하여 준다 <BR><BR>&nbsp; &nbsp; $를 쓰지 않고 변수 이름만 쓰면 된다. C에서 #define처럼 생각하면 될 것이다. <BR><BR><BR>&nbsp; &nbsp; -f 스크립트 파일 <BR><BR>&nbsp; &nbsp; 스크립트를 파일에서 가져온다 <BR><BR>&nbsp; &nbsp; -f 옵션을 여러번 사용하여 여러개 스크립트 파일을 동시에 불러와 지정한 파일에 적용할 수 있다 <BR><BR><BR>3) 필드 ?<BR><BR>&nbsp; : 입력된 각 레코드에서 공백 문자로 구분되는 데이터들을 말한다.<BR><BR>&nbsp; &nbsp; 각각은 $n으로 표시되며, 전체 필드는 $0이다.<BR><BR><BR>4) 자주 사용하는 함수 ?<BR><BR>&nbsp; : length = 주어진 문자열의 문자 개수를 리턴한다.<BR><BR>&nbsp; &nbsp; substr = 지정한 문자열에서 원하는 개수 만큼의 문자를 추출하여 리턴한다.<BR><BR>&nbsp; &nbsp; index = 문자열에서 지정하는 문자열이 있는 위치를 나타낸다.<BR><BR><BR>5) 제어문, 연산자 ?<BR><BR>&nbsp; : for, while, if, break, continue, next, exit<BR><BR><BR>6) 정규화 패턴 ?<BR><BR>&nbsp; : /.../ 의 형식을 가짐 (ex. /^[0-9]+$/)<BR><BR>&nbsp; &nbsp; /패턴/ {동작}<BR><BR>&nbsp; &nbsp; 커맨드 라인에서는 패턴, 동작 전체를 단일 따옴표로 묶는다 <BR><BR>&nbsp; &nbsp; 패턴만 있는 경우 : 패턴과 일치하는 레코드(라인)를 화면에 출력한다 <BR><BR>&nbsp; &nbsp; 동작만 있는 경우 : 모든 레코드(라인)가 동작의 대상이 된다 <BR><BR><BR>7) 동작 ?<BR><BR>&nbsp; &nbsp; 동작은 모두 { }로 둘러싸야 한다 <BR><BR>&nbsp; &nbsp; good이라는 문자열을 포함하는 모든 레코드를 출력할 때 /good/ <BR><BR>&nbsp; &nbsp; 각 레코드의 첫 번째 필드를 출력할 때 { print $1 } <BR><BR>&nbsp; &nbsp; good이라는 문자열을 포함하는 레코드의 첫 번째 필드를 출력할 때 /good/ { print $1 } <BR><BR>&nbsp; &nbsp; 두 개 이상의 필드를 가지는 레코드를 전부 출력할 때(비교연산) NF &gt; 2 <BR><BR>&nbsp; &nbsp; 한 라인(\n)을 필드로, 빈 라인("")을 레코드로 구분할 때 BEGIN { FS = "\n" ; RS = ""} <BR><BR>&nbsp; &nbsp; 첫 번째 필드가 good와 일치하는 레코드에 대해 세 번째 필드를 먼저 출력하고 두 번째 필드를<BR><BR>&nbsp; &nbsp; 나중에 출력하고 싶을 때 $1 ~ /good/ { print $3 , $2 } <BR><BR>&nbsp; &nbsp; good이라는 문자열이 몇 개나 들어가 있는지 계산하여 마지막 부분에서 출력하고 싶을 때<BR>&nbsp; &nbsp; /good/ { ++x } END { print x } <BR><BR>&nbsp; &nbsp; 두 번째 필드를 모두 합하고 마지막 부분에서 두 번째 필드의 총합계를 출력하고 싶을 때<BR>&nbsp; &nbsp; { total += $2 } END { print "Total of $2: " , total } <BR><BR>&nbsp; &nbsp; 레코드의 길이가 20자 이하인 것을 출력하고 싶을 때 length($0) &lt; 20 <BR><BR>&nbsp; &nbsp; 네 개의 필드를 가지며 good이라는 단어로 시작하는 모든 레코드를 출력하고 싶을 때 NF == 4 &amp;&amp; /^good/ <BR><BR>&nbsp; &nbsp; 빈줄을 제외한 모든 줄을 화면에 출력한다 NF &gt; 0 <BR><BR><BR>8) 변수 ?<BR><BR>&nbsp; : NR 레코드수, NF 필드수, FS 필드구분문자, RS 레코드구분문자, FILENAME 현재파일이름<BR><BR><BR>9) 출력 ?<BR><BR>&nbsp; : print, printf, sprintf<BR><BR><BR>ex)<BR><BR>awk 'BEGIN {print "begin"}; {print "statement"} END {print "end"}' [FILENAME]<BR><BR>awk ' BEGIN { for (i = 1;i&lt;=7,i++) print int(101*rand()) }'<BR>&nbsp; : 화면에 1이상 100이하의 난수 일곱 개를 출력한다 <BR><BR>ls -l [FILE1] [FILE2] [FILE3] | awk ' { x += $5 } ; END { print "Total bytes : " x } ' <BR>&nbsp; : 파일들의 크기를 모두 합하여 총 바이트 수를 표시한다 <BR><BR>awk ' END { print NR } ' [FILENAME]<BR>&nbsp; : 지정한 파일의 라인이 몇 개인지를 표시한다 <BR><BR>awk ' NR % 2 == 0 ' [FILENAME]<BR>&nbsp; : 지정한 파일의 짝수번째의 라인만을 출력해 준다 <BR><BR><BR>적용)<BR><BR>tail -f [FILENAME] | awk 'BEGIN {print "start"} ($9 == 500) {print $0} END {print "end"}';<BR>: FILENAME을 읽어서 http응답이 500인 것만 찾아서 출력한다.<BR><BR>tail -f [APACHE LOG] | awk '($9 != 200 &amp;&amp; $9 != 302 &amp;&amp; $9 != 304) {print $0}';<BR>: APACHE LOG를 읽어서 비정상적인 응답을 찾는다.<BR><BR>tail -f [TOMCAT LOG] | awk '/ERROR/ {print $0}';<BR>: TOMCAT LOG를 읽어서 오류인 부분을 찾는다.<BR><BR>ps -aux | awk '/httpd/ {printf "cpu usage:%.1f memory usage:%.1f\n", $3, $4}'<BR>: httpd가 사용하는 리소스를 알아본다.</P>